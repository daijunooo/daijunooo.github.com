<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">

  <!-- Basic Page Needs
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta charset="utf-8">
  
  
  
  
    
  
      <title>å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹ - Tommy Dai</title>
  
  
  <meta name="description" content>
  <meta name="author" content>
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="bookmark" href="/images/favicon.ico">

  <!-- Mobile Specific Metas
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->

 <!-- CSS
  <link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/gridlex.min.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/theme.css">
<link rel="stylesheet" href="/css/share.min.css">
<link rel="stylesheet" href="/css/lightgallery.css">
   â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->

    <link href="https://cdn.bootcss.com/normalize/3.0.2/normalize.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/gridlex/2.3.7/gridlex.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/theme.css">
    <link href="https://cdn.bootcss.com/social-share.js/1.0.11/css/share.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/lightgallery/1.6.8/css/lightgallery.min.css" rel="stylesheet">

  <script src="https://cdn.bootcss.com/js-cookie/2.2.0/js.cookie.min.js"></script>
  <script src="https://cdn.bootcss.com/social-share.js/1.0.11/js/social-share.min.js"></script>
    <!-- <script src="/js/social-share.min.js"></script> -->
    <script src="/js/theme.js"></script>

  <!-- include cookie.js -->
  
  

<link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">
  <header class="header">
	<div class="header-title">
		
			<div class='header-text-no-image'>
				<h1><a href="/">Tommy Dai</a></h1>
				<p><small>Love Coding Love Life</small></p>
			</div>
			
		
	</div>
	<div id="header-menu-container">
		<nav class="menu">
	
		
	
	
	
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/">
					<img src="/images/home.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/">
							<span>Home</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/archives/">
					<img src="/images/archive.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/archives/">
							<span>Archives</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/categories/fun/">
					<img src="/images/fun.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/categories/fun/">
							<span>Fun</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/about/">
					<img src="/images/resume.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/about/">
							<span>About</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/search/">
					<img src="/images/search.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/search/">
							<span>Search</span>
						</a>
					</div>
				</a>
			</div>
		
	
</nav>

	</div>
</header>

  <!-- Primary Page Layout
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <div style="flex: 1;">
      <style>
    body {
        background-color: white;
    }
</style>

<article class="article" id="/2018/08/26/openthird/" data-name='å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹' data-version="">

    <!-- Title -->

    
        
            
                
                
            
        
    

    <div class='article-header'>
         
         <h1 class='article-title'>
            <a href="/2018/08/26/openthird/">
                å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹
            </a>
        </h1>
        
        <ul class='article-categories'>
            
            
                <li><a href="/categories/php/" data-no-instant>
                    <img src="/images/php.svg" alt="php" />
                </a></li>
            
        </ul>
        
    </div>
   
    <!-- Date and Author -->
    <p>
       	2018-08-26
        by Tommy Dai
        
    </p>
    <p>
        

	
		<label><a href="/tags/php-å¾®ä¿¡/">#Php å¾®ä¿¡</a></label>
	


    </p>
	<hr />

    <!-- Gallery -->
    
    

    <!-- Content -->
    <div class='article-content'>
    <h1 id="ç™½è¯è¯´æµç¨‹"><a href="#ç™½è¯è¯´æµç¨‹" class="headerlink" title="ç™½è¯è¯´æµç¨‹"></a>ç™½è¯è¯´æµç¨‹</h1><ul>
<li>æ­¤ç¯‡ä»…é’ˆå¯¹å¾®ä¿¡ç¬¬ä¸‰æ–¹å°ç¨‹åºå¼€å‘æµç¨‹ï¼Œå…¬ä¼—å·å¯ä»¥ç‚¹å‡»å³ä¸Šè§’å…³é—­æµè§ˆå™¨äº†ã€‚<blockquote>
<p>åœ¨è¯´æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³è¯´ä¸€ä¸ªå°æ•…äº‹ã€‚äººé€å¤–å·åˆ€å“¥ï¼ˆå–ç™½ç²‰çš„ï¼‰ï¼Œåˆ€å“¥ä»Šå¤©è¦å»å¤‡è´§ï¼Œåˆ°äº†äº¤æ˜“çš„åœ°ç‚¹åä»–æå‡ºä¸€å¼ å¡ç‰‡ï¼Œå‘è´§çš„äººæ¥è¿‡å¡ç‰‡ä¸€çœ‹ï¼ŒäºŒè¯æ²¡è¯´æŠŠè´§äº¤ç»™äº†åˆ€å“¥ã€‚å…¶ä»–åƒåˆ€å“¥ä¸€æ ·æ¥äº¤æ˜“çš„äººä¹Ÿéƒ½æ˜¯é å¡ç‰‡æ¥æ‹¿è´§ã€‚åæ¥è¶Šæ¥è¶Šå¤šçš„åƒç –å“¥ã€æªå“¥ã€æ‹³å“¥ç­‰ç­‰çš„éƒ½æ“æŒèµ·äº†å–ç™½ç²‰çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ç”±äºä»–ä»¬åªå–„äºå¹²æ¶ï¼Œå¯¹åšç”Ÿæ„æ˜¯ä¸€çªä¸é€šï¼Œæ‰€ä»¥ä»–ä»¬éƒ½æŠŠç”Ÿæ„äº¤ç»™æˆ‘æ¥æ‰“ç†ã€‚ç”±äºæˆ‘æ˜¯ä¸ªè‰¯æ°‘ğŸ˜œï¼Œæ‰€ä»¥æˆ‘æ‰‹ä¸Šæ²¡æœ‰å¡ç‰‡ã€‚æˆ‘åªå¥½å»ç™½ç²‰ä¾›åº”å•†ï¼ˆç®€ç§°ç²‰å•†ï¼‰é‚£é‡Œç­¾ä¸€ä»½åè®®ã€‚å®¡æ ¸é€šè¿‡åæ¯éš”10åˆ†é’Ÿç²‰å•†ä¼šå‘ä¸€æ¡çŸ­ä¿¡ä¸´æ—¶å¡ç»™æˆ‘ï¼Œæˆ‘å¸¦ç€ä¸´æ—¶å¡å»å¯ä»¥æ¢æˆä¸€å¼ æ­£å¼å¡ï¼Œä½†æ˜¯å…‰æœ‰æ­£å¼å¡è¿˜ä¸èƒ½æ›¿ä»–ä»¬æ‹¿è´§ï¼Œæˆ‘è¿˜éœ€è¦ç”¨æˆ‘çš„æ­£å¼å¡å’Œä»–ä»¬ä¸€èµ·å»ç™½ç²‰åä¼šæ¢ä¸€å¼ ä»£ç†å¡ï¼Œæœ‰äº†ä»£ç†å¡åæˆ‘å°±å¯ä»¥æ“ä½œä¸€åˆ‡å¤§å“¥ä»¬æˆæƒç»™æˆ‘çš„ä¸šåŠ¡ã€‚å°±è¿™æ ·æˆ‘æˆäº†ä¸€å¤§ä»£ç†å•†ã€‚æˆ‘å’Œç²‰å•†ä¹‹é—´çš„ä¸šåŠ¡å¾€æ¥ç”¨æˆ‘çš„æ­£å¼å¡ï¼Œæˆ‘æ›¿å¤§å“¥ä»¬æ‰“ç†ç”Ÿæ„ç”¨ä»£ç†å¡ã€‚</p>
</blockquote>
</li>
<li>æ•…äº‹è¯´å®Œäº†ï¼Œæˆ‘å°±æ˜¯å¾®ä¿¡ç¬¬ä¸‰æ–¹å¹³å°ï¼Œå¤§å“¥ä»¬å°±æ˜¯æˆæƒç»™æˆ‘çš„å°ç¨‹åºï¼Œç²‰å•†å°±æ˜¯å¾®ä¿¡æ¥å£ï¼Œå¤§å“¥ä»¬çš„å¡å°±æ˜¯access_token,æˆ‘çš„ä¸´æ—¶å¡æ˜¯component_verify_ticketï¼Œæˆ‘çš„æ­£æ˜¯å¡å°±æ˜¯component_access_tokenï¼Œæˆ‘çš„ä»£ç†å¡å°±æ˜¯authorizer_access_tokenã€‚</li>
<li>ç®€å•è¯´å°±æ˜¯æˆ‘æ‹¿ç€ä»£ç†å¡å¯ä»¥å¸®å¤§å“¥ä»¬èµšé’±ã€‚åé¢æˆ‘ä¼šè¯¦ç»†ä»‹ç»æ€ä¹ˆæ‹¿åˆ°è¿™å¼ ä»£ç†å¡ï¼Œå¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒçš„ç›®çš„å°±æ˜¯æ‹¿åˆ°ä»£ç†å¡ï¼Œä¹Ÿå°±æ˜¯authorizer_access_tokenã€‚</li>
</ul>
<h1 id="å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹"><a href="#å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹" class="headerlink" title="å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹"></a>å¾®ä¿¡ç¬¬ä¸‰æ–¹æˆæƒæµç¨‹</h1><h3 id="step-1-ï¼ˆå’Œç²‰å•†ç­¾åè®®ï¼Œè·å–ä¸´æ—¶å¡ï¼‰"><a href="#step-1-ï¼ˆå’Œç²‰å•†ç­¾åè®®ï¼Œè·å–ä¸´æ—¶å¡ï¼‰" class="headerlink" title="step.1 ï¼ˆå’Œç²‰å•†ç­¾åè®®ï¼Œè·å–ä¸´æ—¶å¡ï¼‰"></a>step.1 ï¼ˆå’Œç²‰å•†ç­¾åè®®ï¼Œè·å–ä¸´æ—¶å¡ï¼‰</h3><ul>
<li>ç”³è¯·å¾®ä¿¡ç¬¬ä¸‰æ–¹å¹³å°</li>
<li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåœ¨ç¬¬ä¸‰æ–¹å¹³å°åˆ›å»ºå®¡æ ¸é€šè¿‡åï¼Œå¾®ä¿¡æœåŠ¡å™¨ æ¯éš”10åˆ†é’Ÿä¼šå‘ç¬¬ä¸‰æ–¹çš„æ¶ˆæ¯æ¥æ”¶åœ°å€æ¨é€ä¸€æ¬¡component_verify_ticketï¼ˆä¸´æ—¶å¡ï¼‰</li>
<li>ä»¥ä¸‹ä»£ç ä»…ä¾›å‚è€ƒï¼Œåœ¨å¼€å‘è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œç”±äºä¸æ¸…æ¥šå¾®ä¿¡å‘é€è¿‡æ¥çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æœ€å¥½æŠŠå‘è¿‡æ¥çš„å‚æ•°å…¨éƒ¨å†™å…¥æ–‡ä»¶ï¼Œç„¶åæ‰“å¼€åç”¨æ¥å£å·¥å…·æ¨¡æ‹ŸåŒæ ·çš„å…¥å‚æ¥ç»§ç»­å¼€å‘ã€‚</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAuthorize</span><span class="token punctuation">(</span>Wxthird <span class="token variable">$wxthird</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//å¾®ä¿¡æœåŠ¡å™¨å‘è¿‡æ¥çš„åŠ å¯†ä¿¡æ¯</span>
    <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$in</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input');</span>
    <span class="token comment" spellcheck="true">//è§£å¯†verify_ticket(è¿”å›XMLæ ¼å¼)</span>
    <span class="token variable">$decryptMsg</span> <span class="token operator">=</span> <span class="token variable">$wxthird</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">decryptVerifyTicket</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string">'msg_signature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$in</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//ä¿å­˜åˆ°æ•°æ®åº“</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'verify_ticket_post'</span><span class="token punctuation">,</span> <span class="token string">'val'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$wxthird</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'verify_ticket_get'</span><span class="token punctuation">,</span> <span class="token string">'val'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$in</span><span class="token punctuation">,</span> <span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$wxthird</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'verify_ticket'</span><span class="token punctuation">,</span> <span class="token string">'val'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$decryptMsg</span><span class="token punctuation">,</span> <span class="token string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$wxthird</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="step-2ï¼ˆæ¢å–æ­£å¼å¡ï¼‰"><a href="#step-2ï¼ˆæ¢å–æ­£å¼å¡ï¼‰" class="headerlink" title="step.2ï¼ˆæ¢å–æ­£å¼å¡ï¼‰"></a>step.2ï¼ˆæ¢å–æ­£å¼å¡ï¼‰</h3><ul>
<li>ç¬¬ä¸‰æ–¹å¹³å°é€šè¿‡è‡ªå·±çš„component_appidï¼ˆå³åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ç®¡ç†ä¸­å¿ƒçš„ç¬¬ä¸‰æ–¹å¹³å°è¯¦æƒ…é¡µä¸­çš„AppIDå’ŒAppSecretï¼‰å’Œcomponent_appsecretï¼Œä»¥åŠcomponent_verify_ticketï¼ˆæ¯10åˆ†é’Ÿæ¨é€ä¸€æ¬¡çš„å®‰å…¨ticketï¼‰æ¥è·å–è‡ªå·±çš„æ¥å£è°ƒç”¨å‡­æ®ï¼ˆcomponent_access_tokenï¼‰</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getComponentAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//æ ¹æ®ç”¨æˆ·component_verify_ticketè·å–ç”¨æˆ·component_access_tokenå­—æ®µ;</span>
    <span class="token variable">$post_data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"component_appid"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">component_appid</span><span class="token punctuation">,</span>
        <span class="token string">"component_appsecret"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">component_appsecret</span><span class="token punctuation">,</span>
        <span class="token string">"component_verify_ticket"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$valString</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_request</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">wxThirdApiUrl</span><span class="token punctuation">[</span><span class="token string">'api_component_token'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$post_data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">component_access_token</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="step-3ï¼ˆæ­¤æ­¥éª¤ç†è§£ä¸ºæˆ‘å’Œç²‰å•†çš„ä¸šåŠ¡ï¼‰"><a href="#step-3ï¼ˆæ­¤æ­¥éª¤ç†è§£ä¸ºæˆ‘å’Œç²‰å•†çš„ä¸šåŠ¡ï¼‰" class="headerlink" title="step.3ï¼ˆæ­¤æ­¥éª¤ç†è§£ä¸ºæˆ‘å’Œç²‰å•†çš„ä¸šåŠ¡ï¼‰"></a>step.3ï¼ˆæ­¤æ­¥éª¤ç†è§£ä¸ºæˆ‘å’Œç²‰å•†çš„ä¸šåŠ¡ï¼‰</h3><ul>
<li>å‰é¢è¯´è¿‡æˆ‘å’Œç²‰å•†çš„ä¸šåŠ¡æ˜¯é€šè¿‡æˆ‘çš„æ­£å¼å¡è¿›è¡Œçš„</li>
<li>è·å–é¢„æˆæƒç pre_auth_code</li>
<li>ç¬¬ä¸‰æ–¹å¹³å°é€šè¿‡è‡ªå·±çš„æ¥å£è°ƒç”¨å‡­æ®ï¼ˆcomponent_access_tokenï¼‰æ¥è·å–ç”¨äºæˆæƒæµç¨‹å‡†å¤‡çš„é¢„æˆæƒç ï¼ˆpre_auth_codeï¼‰</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getPreAuthCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//æ‹¼æ¥url</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">wxThirdApiUrl</span><span class="token punctuation">[</span><span class="token string">'api_create_preauthcode'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getComponentAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$post_data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"component_appid"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">component_appid</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//è·å–ç”¨æˆ·pre_auth_code;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_request</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$post_data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pre_auth_code</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="step-4ï¼ˆè·å–ä»£ç†å¡ï¼‰"><a href="#step-4ï¼ˆè·å–ä»£ç†å¡ï¼‰" class="headerlink" title="step.4ï¼ˆè·å–ä»£ç†å¡ï¼‰"></a>step.4ï¼ˆè·å–ä»£ç†å¡ï¼‰</h3><ul>
<li>æ­¤æ­¥éª¤éœ€è¦æˆ‘çš„æ­£å¼å¡å’Œå¤§å“¥ä»¬çš„æˆæƒï¼ˆæˆæƒç ï¼‰</li>
<li>æ‰€ä»¥éœ€è¦é€šè¿‡ç½‘é¡µæ‰«ç æˆæƒï¼Œæ­¤æ­¥éª¤å¯ä»¥æŸ¥çœ‹å¾®ä¿¡æ–‡æ¡£ï¼Œè¿™é‡Œå°±ç•¥è¿‡äº†</li>
<li>é€šè¿‡æˆæƒç å’Œè‡ªå·±çš„æ¥å£è°ƒç”¨å‡­æ®ï¼ˆcomponent_access_tokenï¼‰ï¼Œæ¢å–å…¬ä¼—å·æˆ–å°ç¨‹åºçš„æ¥å£è°ƒç”¨å‡­æ®ï¼ˆauthorizer_access_tokenå’Œç”¨äºå‰è€…å¿«è¿‡æœŸæ—¶ç”¨æ¥åˆ·æ–°å®ƒçš„authorizer_refresh_tokenï¼‰å’Œæˆæƒä¿¡æ¯ï¼ˆæˆæƒäº†å“ªäº›æƒé™ç­‰ä¿¡æ¯ï¼‰</li>
</ul>
<pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAuthAccessToken</span><span class="token punctuation">(</span><span class="token variable">$authorizer_appid</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$post_data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"component_appid"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">component_appid</span><span class="token punctuation">,</span>
        <span class="token string">"authorizer_appid"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$authorizer_appid</span><span class="token punctuation">,</span>
        <span class="token string">"authorizer_refresh_token"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$authorizer_refresh_token</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$re</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_request</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$post_data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//æ‹¼æ¥åŸå§‹çš„æƒé™æ•°æ®å’Œappidæ•°æ®;</span>
    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">authorizer_access_token</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="å®Œç»“"><a href="#å®Œç»“" class="headerlink" title="å®Œç»“"></a>å®Œç»“</h1><ul>
<li>ä»Šå¤©æ€»ç®—æŠ½æ—¶é—´æŠŠè¿™ä¸ªæµç¨‹ç†æ¸…æ¥šäº†ï¼Œå¯èƒ½é‡Œé¢æœ‰ä¸€äº›ç»†èŠ‚ä¼šç–æ¼ï¼Œå¤§ä½“å°±æ˜¯è¿™ä¹ˆä¸ªæ ·å­äº†ã€‚</li>
<li>ä»¥ä¸Šä»£ç æ‘˜è‡ªç»„å†…å¼€å‘å°ä¼™ä¼´çš„ï¼Œæ„Ÿè°¢ä»–ã€‚æ²¡æœ‰ç»è¿‡ä»–åŒæ„ğŸ˜…</li>
</ul>

    </div>
    <hr />

    <h2>Share and comment</h2>
    <div class="social-share"></div>
    <br />
    
        <div id="comment"></div>
        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
        <script src='//unpkg.com/valine@1.3.6/dist/Valine.min.js'></script>
        <script>
        new Valine({
            el: '#comment' ,
            notify: false,
            verify: false,
            appId: 'Qkxf6mGlzXxuoNkKXnaLqtfQ-gzGzoHsz',
            appKey: '1epaom2Ta3x0GWm0yGC2p1o6',
            placeholder: 'ä½ æƒ³è¯´ç‚¹ä»€ä¹ˆ...',
            path: window.location.pathname,
            avatar: 'retro'
        });
        </script>
    

    
    
</article>
  </div>

  <footer class='footer'>
    <div class='footer-logo'>
        <span></span>
    </div>

    <p> Copyright by <a href="">@Tommy Dai</a> in 2023</p>
</footer>

  <br>

  <div id="footer-menu-container">
		<nav class="menu">
	
		
	
	
	
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/">
					<img src="/images/home.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/">
							<span>Home</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/archives/">
					<img src="/images/archive.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/archives/">
							<span>Archives</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/categories/fun/">
					<img src="/images/fun.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/categories/fun/">
							<span>Fun</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/about/">
					<img src="/images/resume.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/about/">
							<span>About</span>
						</a>
					</div>
				</a>
			</div>
		
	
		
		
			<div class='menu-item grow'>
			
				<div class='menu-icon'>
				<a href="/search/">
					<img src="/images/search.svg" alt="">
					</a>
					</div>
					
					<div class="menu-name">
						<a class='menu-link' href="/search/">
							<span>Search</span>
						</a>
					</div>
				</a>
			</div>
		
	
</nav>

	</div>

  <script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '/js/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>

<script src="/js/lightgallery.min.js"></script>
<script type='text/javascript'>
    lightGallery(document.getElementById('lightgallery'));
</script>

<script data-no-instant type='text/javascript'>
changeLayoutOnTouchScreen();
setVersionForCurrentPage();
setVersionBadgeForIndexPages();
</script>

<!-- End Document
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
</body>
</html>
